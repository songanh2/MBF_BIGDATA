{
	 "description":"etl_adme_wallet_bal_forfeit_edr",
	 "sqlStatements": [
      {
		"sql"      	:"
					SELECT
						CAST(SUBSTRING($day_key,1,6) as INTEGER) as MO_KEY,
						CAST(NULL as INTEGER) as HOUR_KEY,
						CAST(NULL as STRING) as UUID,
						CAST(NULL as TIMESTAMP) as EVT_DT,
						CAST(NULL as TIMESTAMP) as EVT_BLLG_START_DT,
						CAST(dih.ftp_filename as STRING) as FILE_NAME,
						CAST(NULL as TIMESTAMP) as FILE_DT,
						CAST(NULL as STRING) as FILE_PREFIX_CD,
						CAST(NULL as TIMESTAMP) as REC_PROCESS_DT,
						CAST(NULL as STRING) as SWITCH_CD,
						CAST(aas.acct_srvc_instance_key as DECIMAL(27,0)) as ACCT_SRVC_INSTANCE_KEY,
						CAST(dih.card_number as STRING) as SERVICE_NBR,
						CAST(aas.acct_key as DECIMAL(27,0)) as ACCT_KEY,
						CAST(aas.billable_acct_key as DECIMAL(27,0)) as BILLABLE_ACCT_KEY,
						CAST(aas.cust_key as DECIMAL(27,0)) as CUST_KEY,
						CAST(aas.cust_typ_cd as STRING) as CUST_TYP_CD,
						CAST(aas.ntwk_qos_grp_cd as STRING) as NTWK_QOS_GRP_CD,
						CAST(NULL as TIMESTAMP) as ACCT_ACTIVATION_DT,
						CAST(NULL as TIMESTAMP) as ACCT_CBS_ACTIVATION_DT,
						CAST(aas.lfcycl_stat_cd as STRING) as ACCT_LFCYCL_STAT_CD,
						CAST(aas.activation_dt as TIMESTAMP) as SRVC_ACTIVATION_DT,
						CAST(aas.cbs_activation_dt as TIMESTAMP) as SRVC_CBS_ACTIVATION_DT,
						CAST(aas.lfcycl_stat_cd as STRING) as SRVC_LFCYCL_STAT_CD,
						CAST(aas.prod_line_key as INTEGER) as PROD_LINE_KEY,
						CAST(aas.usage_plan_key as BIGINT) as USAGE_PLAN_KEY,
						CAST(aas.usage_plan_cd as STRING) as USAGE_PLAN_CD,
						CAST(aas.usage_plan_typ_cd as STRING) as USAGE_PLAN_TYP_CD,
						CAST(aas.crm_offer_key as BIGINT) as OFFER_KEY,
						CAST(aas.crm_offer_cd as STRING) as OFFER_CD,
						CAST(NULL as DECIMAL(20,0)) as PROD_KEY,
						CAST(NULL as STRING) as PROD_CD,
						CAST(NULL as STRING) as EVT_CLASS_CD,
						CAST(NULL as STRING) as EVT_CTGRY_CD,
						CAST(NULL as STRING) as EVT_TYP_CD,
						CAST(NULL as STRING) as USAGE_TYP_CD,
						CAST(NULL as STRING) as BILL_GRP_CD,
						CAST(NULL as BIGINT) as BILL_CYCLE_KEY,
						CAST(NULL as INTEGER) as CHRG_HEAD_KEY,
						CAST(NULL as STRING) as CHRG_HEAD_CD,
						CAST(NULL as STRING) as BLLG_STAT_RSN_CD,
						CAST(aw.wallet_key as BIGINT) as WALLET_KEY,
						CAST(aw.wallet_cd as STRING) as WALLET_CD,
						CAST(aw.wallet_typ_cd as STRING) as WALLET_TYP_CD,
						CAST(aw.uom_cd as STRING) as WALLET_UOM_CD,
						CAST(2 as INTEGER) as WALLET_BAL_FORFEIT_TYP,
						CAST(dih.main_balance as DECIMAL(27,8)) as WALLET_BAL_FORFEIT_AMT,
						CAST(NULL as DECIMAL(27,8)) as WALLET_BAL_VALUE_BEFR_IMPACT,
						CAST(NULL as DECIMAL(27,8)) as WALLET_BAL_VALUE_AFTR_IMPACT,
						CAST(NULL as TIMESTAMP) as WALLET_VLD_TO_DT_BEFOR_IMPACT,
						CAST(NULL as TIMESTAMP) as WALLET_VLD_TO_DT_AFTR_IMPACT,
						CAST(NULL as STRING) as WALLET_FORFEIT_RSN_CD,
						CAST(NULL as DECIMAL(27,8)) as ADDR_LAT,
						CAST(NULL as DECIMAL(27,8)) as ADDR_LON,
						CAST(NULL as BIGINT) as CELL_KEY,
						CAST(NULL as STRING) as CELL_CD,
						CAST(NULL as BIGINT) as CELL_SITE_KEY,
						CAST(NULL as STRING) as CELL_SITE_CD,
						CAST(NULL as BIGINT) as NTWK_MGNT_CENTRE_KEY,
						CAST(NULL as STRING) as NTWK_MGNT_CENTRE_CD,
						CAST(aas.bsns_rgn_key as BIGINT) as BSNS_RGN_KEY,
						CAST(aas.bsns_rgn_cd as STRING) as BSNS_RGN_CD,
						CAST(aas.bsns_cluster_key as BIGINT) as BSNS_CLUSTER_KEY,
						CAST(aas.bsns_cluster_cd as STRING) as BSNS_CLUSTER_CD,
						CAST(aas.bsns_minicluster_key as BIGINT) as BSNS_MINICLUSTER_KEY,
						CAST(aas.bsns_minicluster_cd as STRING) as BSNS_MINICLUSTER_CD,
						CAST(504003 as BIGINT) as GEO_CNTRY_KEY,
						CAST('VN' as STRING) as GEO_CNTRY_CD,
						CAST(aas.geo_state_key as BIGINT) as GEO_STATE_KEY,
						CAST(aas.geo_state_cd as STRING) as GEO_STATE_CD,
						CAST(aas.geo_dstrct_key as BIGINT) as GEO_DSTRCT_KEY,
						CAST(aas.geo_dstrct_cd as STRING) as GEO_DSTRCT_CD,
						CAST(aas.geo_city_key as BIGINT) as GEO_CITY_KEY,
						CAST(aas.geo_city_cd as STRING) as GEO_CITY_CD,
						CAST(NULL as TIMESTAMP) as ACQSTN_DT,
						CAST(aas.acqstn_bsns_outlet_key as BIGINT) as ACQSTN_BSNS_OUTLET_KEY,
						CAST(aas.acqstn_bsns_outlet_cd as STRING) as ACQSTN_BSNS_OUTLET_CD,
						CAST(aas.loyalty_rank_score as DECIMAL(12,4)) as LOYALTY_RANK_SCORE,
						CAST(aas.loyalty_score_dt as TIMESTAMP) as LOYALTY_SCORE_DT,
						CAST(NULL as DECIMAL(12,4)) as CREDIT_SCORE,
						CAST(NULL as STRING) as CREDIT_CLASS_CD,
						CAST(NULL as STRING) as CREDIT_SCORE_METHOD,
						CAST(NULL as TIMESTAMP) as CREDIT_SCORE_DT,
						CAST(NULL as INTEGER) as RISK_IND,
						CAST(NULL as STRING) as ACCT_SEGMENT_CD,
						CAST(NULL as STRING) as ACCT_SEGMENT_DT,
						CAST(NULL as STRING) as CMPGN_CD,
						CAST(7 as BIGINT) as SRC_SYS_KEY,
						CAST(dih.src_sys_cd as STRING) as SRC_SYS_CD,
						CAST(CURRENT_TIMESTAMP() as TIMESTAMP) as LOAD_DT,
						CAST('1' as STRING) as CURR_IND,
						CAST(1 as INTEGER) as WRHS_ID
					FROM 
						(
							select 
								u.*,
								'CREDIT' as wallet_cd
							from 
							(
								select 
									card_number,
									rowids,
									main_balance,
									mobile_set_id,
									account_profile,
									status,
									begin_inactivity_date,
									end_inactivity_date,
									account_creation_date,
									last_topup_date,
									begin_activity_date,
									column12,
									column13,
									friends_and_family_list,
									column15,
									column16,
									date_lock_2,
									column18,
									column19,
									column20,
									column21,
									column22,
									column23,
									column24,
									location,
									languages,
									loc1,
									loc2,
									loc3,
									loc4,
									account_block,
									dump_datetime,
									ftp_filename,
									day_key,
									'IN_DUMP_HN' as src_sys_cd
								from mbf_datalake.dump_info_hn where day_key = date_format(date_add(from_unixtime(unix_timestamp('$day_key','yyyyMMdd')),1),'yyyyMMdd') and lower(card_number) <> 'card_number'
							union all
								select 
									card_number,
									rowids,
									main_balance,
									mobile_set_id,
									account_profile,
									status,
									begin_inactivity_date,
									end_inactivity_date,
									account_creation_date,
									last_topup_date,
									begin_activity_date,
									column12,
									column13,
									friends_and_family_list,
									column15,
									column16,
									date_lock_2,
									column18,
									column19,
									column20,
									column21,
									column22,
									column23,
									column24,
									location,
									languages,
									loc1,
									loc2,
									loc3,
									loc4,
									account_block,
									dump_datetime,
									ftp_filename,
									day_key,
									'IN_DUMP_HCM' as src_sys_cd
								from mbf_datalake.dump_info_hcm where day_key = date_format(date_add(from_unixtime(unix_timestamp('$day_key','yyyyMMdd')),1),'yyyyMMdd') and lower(card_number) <> 'card_number'
							) u
						) dih
					LEFT JOIN 
						(SELECT * FROM mbf_bigdata.admr_account_service WHERE day_key = '$day_key' and curr_ind = '1') aas
					ON dih.card_number = aas.service_nbr
					LEFT JOIN 
						(SELECT * FROM mbf_bigdata.admr_wallet WHERE day_key = '$day_key' and curr_ind = '1') aw
					ON dih.wallet_cd = aw.wallet_cd
					WHERE
						aas.lfcycl_stat_cd = '4' and cast(nvl(dih.main_balance,0) as DECIMAL(27,8)) > 0
                    ",
		"tempTable"  : "adme_wallet_bal_forfeit_edr_tmp",
		"countSourceRecord":"0"
	  }   	  
	]
}